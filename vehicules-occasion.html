<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/svg+xml" href="images/favicon.svg">
    <meta name="description" content="Découvrez nos véhicules d'occasion et récents (moins de 3 ans). Large choix de voitures à prix compétitifs pour la France et l'Europe.">
    <title>Véhicules d'Occasion - MBOULHI AUTO</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/vehicules.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Header / Navigation -->
    <header class="header" id="header">
        <nav class="navbar">
            <div class="container">
                <div class="nav-wrapper">
                    <a href="index.html" class="logo">
                        <img src="images/logo.png" alt="MBOULHI AUTO Logo">
                    </a>

                    <button class="nav-toggle" id="navToggle" aria-label="Toggle navigation">
                        <span></span>
                        <span></span>
                        <span></span>
                    </button>

                    <ul class="nav-menu" id="navMenu">
                        <li><a href="index.html" class="nav-link">Accueil</a></li>
                        <li><a href="vehicules-neufs.html" class="nav-link">Véhicules Neufs</a></li>
                        <li><a href="vehicules-occasion.html" class="nav-link active">Véhicules d'Occasion</a></li>
                        <li><a href="about.html" class="nav-link">À Propos</a></li>
                        <li><a href="contact.html" class="nav-link">Contact</a></li>
                    </ul>

                    <div class="nav-actions">
                        <a href="https://wa.me/33636121035" class="btn btn-call" target="_blank">
                            <i class="fab fa-whatsapp"></i> WhatsApp
                        </a>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <!-- Page Header -->
    <section class="page-header" style="background-image: url('images/occasion-couverture.jpeg'); background-size: cover; background-position: center;">
        <div class="page-header-overlay"></div>
        <div class="container" style="position: relative; z-index: 1;">
            <h1 class="page-title">Véhicules d'Occasion</h1>
            <p class="page-subtitle">Véhicules d'occasion et récents (moins de 3 ans) pour la France et l'Europe</p>
        </div>
    </section>

    <!-- Filtres -->
    <section class="filters-section section">
        <div class="container">
            <div class="filters-header">
                <h2><i class="fas fa-filter"></i> Filtrer les véhicules</h2>
                <button id="resetFilters" class="btn-reset">
                    <i class="fas fa-redo"></i> Réinitialiser
                </button>
            </div>

            <div class="filters-grid">
                <!-- Catégorie -->
                <div class="filter-group">
                    <label for="filterCategory">
                        <i class="fas fa-tag"></i> Catégorie
                    </label>
                    <select id="filterCategory" class="filter-input">
                        <option value="">Toutes catégories</option>
                        <option value="recent">Moins de 3 ans</option>
                        <option value="occasion">Occasion classique</option>
                    </select>
                </div>


                <!-- Marque -->
                <div class="filter-group">
                    <label for="filterBrand">
                        <i class="fas fa-car"></i> Marque
                    </label>
                    <input type="text" id="filterBrand" class="filter-input" placeholder="Ex: Peugeot">
                </div>

                <!-- Prix minimum -->
                <div class="filter-group">
                    <label for="filterMinPrice">
                        <i class="fas fa-euro-sign"></i> Prix min
                    </label>
                    <input type="number" id="filterMinPrice" class="filter-input" placeholder="0 €" min="0" step="1000">
                </div>

                <!-- Prix maximum -->
                <div class="filter-group">
                    <label for="filterMaxPrice">
                        <i class="fas fa-euro-sign"></i> Prix max
                    </label>
                    <input type="number" id="filterMaxPrice" class="filter-input" placeholder="50 000 €" min="0" step="1000">
                </div>

                <!-- Carburant -->
                <div class="filter-group">
                    <label for="filterFuel">
                        <i class="fas fa-gas-pump"></i> Carburant
                    </label>
                    <select id="filterFuel" class="filter-input">
                        <option value="">Tous</option>
                        <option value="Essence">Essence</option>
                        <option value="Diesel">Diesel</option>
                        <option value="Électrique">Électrique</option>
                        <option value="Hybride">Hybride</option>
                    </select>
                </div>

                <!-- Transmission -->
                <div class="filter-group">
                    <label for="filterTransmission">
                        <i class="fas fa-cog"></i> Transmission
                    </label>
                    <select id="filterTransmission" class="filter-input">
                        <option value="">Toutes</option>
                        <option value="Manuelle">Manuelle</option>
                        <option value="Automatique">Automatique</option>
                    </select>
                </div>
            </div>
        </div>
    </section>

    <!-- Résultats -->
    <section class="vehicles-section section section-dark">
        <div class="container">
            <div class="results-header">
                <h2 id="resultsCount">Chargement...</h2>
                <div class="view-options">
                    <button class="view-btn active" data-view="grid" title="Vue grille">
                        <i class="fas fa-th"></i>
                    </button>
                    <button class="view-btn" data-view="list" title="Vue liste">
                        <i class="fas fa-list"></i>
                    </button>
                </div>
            </div>

            <div class="vehicles-grid" id="vehiclesContainer">
                <!-- Les véhicules seront chargés dynamiquement via JavaScript -->
                <div style="grid-column: 1/-1; text-align: center; padding: 3rem;">
                    <i class="fas fa-spinner fa-spin" style="font-size: 3rem; color: var(--primary-color);"></i>
                    <p style="margin-top: 1rem; color: var(--text-white);">Chargement des véhicules...</p>
                </div>
            </div>
        </div>
    </section>

    <!-- CTA Section -->
    <section class="cta-section">
        <div class="container">
            <div class="cta-content">
                <h2>Vous n'avez pas trouvé ce que vous cherchez ?</h2>
                <p>Contactez-nous et nous trouverons le véhicule idéal pour vous</p>
                <div class="cta-buttons">
                    <a href="https://wa.me/33636121035" class="btn btn-whatsapp" target="_blank">
                        <i class="fab fa-whatsapp"></i> WhatsApp
                    </a>
                    <a href="tel:+33636121035" class="btn btn-phone">
                        <i class="fas fa-phone"></i> Appeler
                    </a>
                    <a href="contact.html" class="btn btn-outline-white">
                        <i class="fas fa-envelope"></i> Email
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-column">
                    <img src="images/logo.png" alt="MBOULHI AUTO" class="footer-logo">
                    <p class="footer-description">
                        Votre partenaire de confiance pour l'achat de véhicules neufs et d'occasion.
                        Spécialistes de l'export France - Algérie - Europe.
                    </p>
                    <div class="social-links">
                        <a href="https://www.tiktok.com/@mboulhi.dz" target="_blank" aria-label="TikTok"><i class="fab fa-tiktok"></i></a>
                        <a href="https://www.facebook.com/Mboulhi.DZ" target="_blank" aria-label="Facebook"><i class="fab fa-facebook"></i></a>
                        <a href="https://www.youtube.com/@mboulhidz" target="_blank" aria-label="YouTube"><i class="fab fa-youtube"></i></a>
                        <a href="https://www.instagram.com/mboulhi_dz/reels/" target="_blank" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                    </div>
                </div>

                <div class="footer-column">
                    <h4>Liens Rapides</h4>
                    <ul class="footer-links">
                        <li><a href="index.html">Accueil</a></li>
                        <li><a href="vehicules-neufs.html">Véhicules Neufs</a></li>
                        <li><a href="vehicules-occasion.html">Véhicules d'Occasion</a></li>
                        <li><a href="about.html">À Propos</a></li>
                        <li><a href="contact.html">Contact</a></li>
                    </ul>
                </div>

                <div class="footer-column">
                    <h4>Nos Véhicules</h4>
                    <ul class="footer-links">
                        <li><a href="vehicules-neufs.html">Véhicules Neufs (Export)</a></li>
                        <li><a href="vehicules-occasion.html">Véhicules d'Occasion</a></li>
                    </ul>
                </div>

                <div class="footer-column">
                    <h4>Contact</h4>
                    <ul class="footer-contact">
                        <li>
                            <i class="fas fa-phone"></i>
                            <a href="tel:+33636121035">+33 6 36 12 10 35</a>
                        </li>
                        <li>
                            <i class="fas fa-envelope"></i>
                            <a href="mailto:contact@mboulhiauto.fr">contact@mboulhiauto.fr</a>
                        </li>
                        <li>
                            <i class="fas fa-map-marker-alt"></i>
                            <span>69 chem. Neuf, 69780 Toussieu</span>
                        </li>
                        <li>
                            <i class="fas fa-clock"></i>
                            <span>Lun-Sam: 10h-19h</span>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="footer-bottom">
                <p>&copy; 2026 MBOULHI AUTO. Tous droits réservés.</p>
                <div class="footer-legal">
                    <a href="mentions-legales.html">Mentions Légales</a>
                    <a href="politique-confidentialite.html">Politique de Confidentialité</a>
                    <a href="cgv.html">CGV</a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bouton WhatsApp flottant -->
    <a href="https://wa.me/33636121035" class="whatsapp-float" target="_blank" aria-label="Contactez-nous sur WhatsApp">
        <i class="fab fa-whatsapp"></i>
    </a>

    <!-- Bouton retour en haut -->
    <button class="scroll-top" id="scrollTop" aria-label="Retour en haut">
        <i class="fas fa-arrow-up"></i>
    </button>

    
    <script src="js/vehicles-api.js"></script>
    <script src="js/main.js"></script>
    <script>
        // Page Véhicules d'Occasion - Afficher occasion + moins de 3 ans (EXCLURE neufs)

        document.addEventListener('DOMContentLoaded', async function() {
            // Charger les véhicules d'occasion
            await displayVehiclesOccasion();

            // Remplacer le comportement du bouton réinitialiser
            const resetBtn = document.getElementById('resetFilters');
            if (resetBtn) {
                const newResetBtn = resetBtn.cloneNode(true);
                resetBtn.parentNode.replaceChild(newResetBtn, resetBtn);

                newResetBtn.addEventListener('click', function() {
                    // Réinitialiser tous les filtres (pas de type par défaut pour occasion)
                    currentFilters = {};

                    // Réinitialiser les champs du formulaire
                    const filterCategory = document.getElementById('filterCategory');
                    const filterBrand = document.getElementById('filterBrand');
                    const filterMinPrice = document.getElementById('filterMinPrice');
                    const filterMaxPrice = document.getElementById('filterMaxPrice');
                    const filterFuel = document.getElementById('filterFuel');
                    const filterTransmission = document.getElementById('filterTransmission');

                    if (filterCategory) filterCategory.value = '';
                    if (filterBrand) filterBrand.value = '';
                    if (filterMinPrice) filterMinPrice.value = '';
                    if (filterMaxPrice) filterMaxPrice.value = '';
                    if (filterFuel) filterFuel.value = '';
                    if (filterTransmission) filterTransmission.value = '';

                    displayVehiclesOccasion();
                });
            }

            // Gestion du filtre catégorie
            const filterCategory = document.getElementById('filterCategory');
            if (filterCategory) {
                filterCategory.addEventListener('change', function() {
                    if (this.value === 'recent') {
                        currentFilters.categoryFilter = 'recent';
                    } else if (this.value === 'occasion') {
                        currentFilters.categoryFilter = 'occasion';
                    } else {
                        delete currentFilters.categoryFilter;
                    }
                    displayVehiclesOccasion();
                });
            }

            // Initialiser les autres filtres
            initOccasionFilters();
        });

        function initOccasionFilters() {
            const filterBrand = document.getElementById('filterBrand');
            const filterMinPrice = document.getElementById('filterMinPrice');
            const filterMaxPrice = document.getElementById('filterMaxPrice');
            const filterFuel = document.getElementById('filterFuel');
            const filterTransmission = document.getElementById('filterTransmission');

            if (filterBrand) {
                filterBrand.addEventListener('input', function() {
                    currentFilters.brand = this.value || null;
                    displayVehiclesOccasion();
                });
            }

            if (filterMinPrice) {
                filterMinPrice.addEventListener('input', function() {
                    currentFilters.minPrice = this.value || null;
                    displayVehiclesOccasion();
                });
            }

            if (filterMaxPrice) {
                filterMaxPrice.addEventListener('input', function() {
                    currentFilters.maxPrice = this.value || null;
                    displayVehiclesOccasion();
                });
            }

            if (filterFuel) {
                filterFuel.addEventListener('change', function() {
                    currentFilters.fuel = this.value || null;
                    displayVehiclesOccasion();
                });
            }

            if (filterTransmission) {
                filterTransmission.addEventListener('change', function() {
                    currentFilters.transmission = this.value || null;
                    displayVehiclesOccasion();
                });
            }
        }

        async function displayVehiclesOccasion() {
            const vehiclesContainer = document.getElementById('vehiclesContainer');
            const resultsCount = document.getElementById('resultsCount');

            if (!vehiclesContainer) return;

            // Afficher un loader
            vehiclesContainer.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 3rem;"><i class="fas fa-spinner fa-spin" style="font-size: 3rem; color: var(--primary-color);"></i></div>';

            // Obtenir tous les véhicules
            const allVehicles = await getAllVehicles();

            // Filtrer pour EXCLURE les véhicules neufs
            // Garder uniquement: occasion, recent, moins de 3 ans
            let vehicles = allVehicles.filter(vehicle => {
                if (!vehicle.types) return false;
                // Exclure les véhicules qui ont UNIQUEMENT le tag "neuf"
                if (vehicle.types.includes('neuf') && vehicle.types.length === 1) return false;
                // Garder si contient occasion, recent, ou moins de 3 ans
                return vehicle.types.includes('occasion') ||
                       vehicle.types.includes('recent') ||
                       vehicle.types.includes('moins de 3 ans');
            });

            // Appliquer le filtre de catégorie si sélectionné
            if (currentFilters.categoryFilter === 'recent') {
                vehicles = vehicles.filter(v =>
                    v.types.includes('recent') || v.types.includes('moins de 3 ans')
                );
            } else if (currentFilters.categoryFilter === 'occasion') {
                vehicles = vehicles.filter(v =>
                    v.types.includes('occasion') &&
                    !v.types.includes('recent') &&
                    !v.types.includes('moins de 3 ans')
                );
            }

            // Appliquer les autres filtres
            vehicles = vehicles.filter(vehicle => {
                if (currentFilters.brand) {
                    const searchBrand = currentFilters.brand.toLowerCase();
                    if (!vehicle.brand.toLowerCase().includes(searchBrand)) return false;
                }
                if (currentFilters.minPrice && vehicle.price < Number(currentFilters.minPrice)) return false;
                if (currentFilters.maxPrice && vehicle.price > Number(currentFilters.maxPrice)) return false;
                if (currentFilters.fuel && vehicle.fuel !== currentFilters.fuel) return false;
                if (currentFilters.transmission && vehicle.transmission !== currentFilters.transmission) return false;
                return true;
            });

            // Afficher le nombre de résultats
            if (resultsCount) {
                resultsCount.textContent = `${vehicles.length} véhicule${vehicles.length > 1 ? 's' : ''} trouvé${vehicles.length > 1 ? 's' : ''}`;
            }

            // Afficher les véhicules
            vehiclesContainer.innerHTML = '';

            if (vehicles.length === 0) {
                vehiclesContainer.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 3rem;">
                        <i class="fas fa-search" style="font-size: 3rem; color: var(--text-light); margin-bottom: 1rem;"></i>
                        <h3 style="color: white;">Aucun véhicule trouvé</h3>
                        <p style="color: var(--text-light);">Essayez de modifier vos critères de recherche</p>
                    </div>
                `;
                return;
            }

            vehicles.forEach(vehicle => {
                const card = createVehicleCard(vehicle);
                vehiclesContainer.appendChild(card);
            });
        }
    </script>
</body>
</html>
